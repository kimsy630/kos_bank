<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace = "spring.mvc.teamProject.persistence.AutoTransferDAO">
	
	<!-- 자동이체 신청 -->
	<insert id="AutoTransferAdd" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		INSERT 
		INTO auto_transfer
			(jd_key, account, jd_autoMoney, 
			jd_outDate,	jd_account, jd_inPlace, jd_outCycle, jd_registDate, jd_expirationDate )
		VALUES(
			SEQ_AUTOTRANSFER.nextval, #{account}, #{jd_autoMoney},
			#{jd_outDate}, #{jd_account}, #{jd_inPlace}, #{jd_outCycle}, TO_DATE(#{jd_registDate}, 'YYYY-MM-DD'), TO_DATE(#{jd_expirationDate}, 'YYYY-MM-DD') )
	</insert> 
	
	<!-- 자동이체 삭제 -->
	<!--<delete id="AutoTransferDelete" parameterType="spring.mvc.teamProject.vo.AutoTransferVO" >
		DELETE from auto_transfer
		WHERE jd_key = #{ jd_key }
	</delete> -->
	
	<!-- 자동이체 변경 -->
	<!--<update id="AutoTransferModify" parameterType="spring.mvc.teamProject.vo.AutoTransferVO" >
		UPDATE auto_transfer
		SET 
		jd_type	= #{jd_type}, 
		jd_autoMoney = #{jd_autoMoney}, 
		jd_outDate	= #{jd_outDate}, 
		jd_account	= #{jd_account}, 
		jd_inPlace = #{jd_inPlace}, 
		jd_outCycle	= #{jd_outCycle}, 
		jd_registDate = #{jd_registDate}
		WHERE jd_key = #{ jd_key }
	</update> -->
	
	
	<!-- 자동이체 실행되는 Mapper -->
	<!-- 자동이체 정보 조회 -->
	<select id="selectByDate" resultType="spring.mvc.teamProject.vo.AutoTransferVO">
		SELECT jd_key, account, jd_autoMoney, jd_account, jd_inPlace, jd_status
		FROM auto_transfer
		WHERE jd_outDate = #{day}
	</select>


	<!-- 자동이체 계좌 출금 -->
	<update id="AutoWithdrawal" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		UPDATE account_info
		SET	Balance=Balance - #{jd_autoMoney}
		WHERE account = #{account}
	</update>


	<!-- 자동이체 상대계좌 입금 -->
	<update id="AutoDeposit" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		UPDATE account_info
		SET	Balance=Balance + #{jd_autoMoney}
		WHERE account = #{jd_account}
	</update>


	<!-- 자동이체 최근거래일자 -->
	<update id="lastRunDate" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		UPDATE auto_transfer
		SET
		jd_autoLastDay = sysdate
		WHERE jd_key = #{jd_key}
	</update>

	
	<!-- 자동이체 - 거래내역 로그(출금 거래내역)-->
	<insert id="sendAutoTrans" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		INSERT 
		INTO auto_transfer(account, jd_key, jd_autoMoney,jd_account)
		VALUES( #{account}, SEQ_AUTOTRANSFER.nextval, #{jd_autoMoney},#{jd_account})		
	</insert>


	<!-- 자동이체 - 거래내역 로그(입금 거래내역) -->
	<insert id="receiveAutoTrans" parameterType="spring.mvc.teamProject.vo.AutoTransferVO">
		INSERT 
		INTO auto_transfer(jd_account, jd_key, jd_autoMoney,account)
		VALUES( #{ jd_account }, SEQ_AUTOTRANSFER.nextval, #{jd_autoMoney}, #{account})
	</insert>
	
	
	
</mapper>